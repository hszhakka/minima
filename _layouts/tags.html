---
layout: page
---

{{ content }}

{%- assign max_count = 0 -%}
{%- for tag in site.tags -%}
  {%- assign posts = tag[1] -%}
  {%- if posts.size > max_count -%}
    {%- assign max_count = posts.size -%}
  {%- endif -%}
{%- endfor -%}

<ul class="site-tags">
  {%- for i in (1..max_count) reversed -%}
    {%- for tag in site.tags -%}
      {%- assign tag_name = tag[0] -%}
      {%- assign posts = tag[1] -%}
      {%- if posts.size == i -%}
        <li>
          {%- capture tag_url -%}/tags/{{ tag_name | slugify }}.html{%- endcapture -%}
          {%- capture title -%}{{ posts.size }} {% if posts.size == 1 %}post{% else %}posts{% endif %}{%- endcapture -%}
          <a class="site-tag" href="{{ tag_url | relative_url }}" title="{{ title }}" data-count="{{ posts.size }}">{{ tag_name }}</a>
        </li>
      {%- endif -%}
    {%- endfor -%}
  {%- endfor -%}
</ul>

<script>
  // This hashing algorithm is from 
  //   https://cp-algorithms.com/string/string-hashing.html
  function hashingToColor(str) {
    // It is reasonable to make p a prime number roughly equal to the number of 
    // characters in the input alphabet. Here all values in a byte are viewed as 
    // characters, so let p = 257.
    const p = 257;
    // Obviously m should be a large number, since the probability of two random
    // strings colliding is about 1/m. Since this function returns a color value,
    // m can be set as 16^6 = 16777216.
    const m = 16777216;
    let hash = 0;
    let pow = 1;
    for (let i = 0; i < str.length; i++) {
        const c = str.codePointAt(i);
        hash = (hash + c * pow) % m;
        pow = (pow * p) % m;
    }
    return hash;
  }

  function isLight(color) {
    const hexColor = parseInt(color.toString(16), 16);
    const r = hexColor >> 16 & 0xFF;
    const g = hexColor >> 8 & 0xFF;
    const b = hexColor & 0xFF;
    // Use weighted Euclidean distance in 3D RGB space. See
    //   https://thoughtbot.com/blog/closer-look-color-lightness
    hsp = Math.sqrt(0.299 * (r * r) + 0.587 * (g * g) + 0.114 * (b * b));
    return hsp > 127.5 ? true : false;
  }

  let allCounts = 0;

  const elements = document.getElementsByClassName("site-tag");
  for (let element of elements) {
    const count = parseInt(element.dataset.count);
    allCounts += count;

    var backgroundColor = hashingToColor(element.textContent);
    element.style.background = `#${backgroundColor.toString(16).padStart(6, "0")}`;
    element.style.color = `#${isLight(backgroundColor) ? "000000" : "FFFFFF"}`;
    element.style.borderColor = 'grey';
  }

  const averageCount = allCounts / elements.length;

  const style = getComputedStyle(document.querySelector("body"));
  const baseFontSize = parseInt(style.fontSize);
  const minFontSize = baseFontSize / 2;

  for (let element of elements) {
    const count = parseInt(element.dataset.count);
    const fontSize = baseFontSize + count - Math.floor(averageCount);
    if (fontSize < minFontSize) {
      fontSize = minFontSize;
    }
    element.style.fontSize = `${fontSize}px`;
  }
</script>
